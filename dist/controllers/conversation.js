"use strict";

const Conversation = require("../models/conversation");

const Message = require("../models/message");

exports.postConversationsCreate = (req, res, next) => {
  const {
    userOneId,
    userTwoId
  } = req.body;
  Conversation.findOne({
    where: {
      userTwoId: Number(userTwoId)
    },
    attributes: ["id", "userOneId", "userTwoId"]
  }).then(conversation => {
    if (conversation) {
      return res.status(403).json({
        message: "Conversation is exist already"
      });
    }

    return;
  }).then(result => {
    Conversation.create({
      userOneId: userOneId,
      userTwoId: userTwoId
    }).then(conversation => {
      res.status(201).json(conversation);
    }).catch(err => {
      const error = new Error(err);
      error.httpStatusCode = 500;
      return next(error);
    });
  });
};

exports.getConversationsList = (req, res, next) => {
  Conversation.findAll({
    attributes: ["id", "userOneId", "userTwoId"]
  }).then(conversations => {
    res.status(200).json({
      conversations: conversations
    });
  }).catch(err => {
    const error = new Error(err);
    error.httpStatusCode = 500;
    return next(error);
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250cm9sbGVycy9jb252ZXJzYXRpb24uanMiXSwibmFtZXMiOlsiQ29udmVyc2F0aW9uIiwicmVxdWlyZSIsIk1lc3NhZ2UiLCJleHBvcnRzIiwicG9zdENvbnZlcnNhdGlvbnNDcmVhdGUiLCJyZXEiLCJyZXMiLCJuZXh0IiwidXNlck9uZUlkIiwidXNlclR3b0lkIiwiYm9keSIsImZpbmRPbmUiLCJ3aGVyZSIsIk51bWJlciIsImF0dHJpYnV0ZXMiLCJ0aGVuIiwiY29udmVyc2F0aW9uIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJjcmVhdGUiLCJjYXRjaCIsImVyciIsImVycm9yIiwiRXJyb3IiLCJodHRwU3RhdHVzQ29kZSIsImdldENvbnZlcnNhdGlvbnNMaXN0IiwiZmluZEFsbCIsImNvbnZlcnNhdGlvbnMiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsd0JBQUQsQ0FBNUI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsbUJBQUQsQ0FBdkI7O0FBRUFFLE9BQU8sQ0FBQ0MsdUJBQVIsR0FBa0MsQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsS0FBb0I7QUFDcEQsUUFBTTtBQUFFQyxJQUFBQSxTQUFGO0FBQWFDLElBQUFBO0FBQWIsTUFBMkJKLEdBQUcsQ0FBQ0ssSUFBckM7QUFFQVYsRUFBQUEsWUFBWSxDQUFDVyxPQUFiLENBQXFCO0FBQ25CQyxJQUFBQSxLQUFLLEVBQUU7QUFDTEgsTUFBQUEsU0FBUyxFQUFFSSxNQUFNLENBQUNKLFNBQUQ7QUFEWixLQURZO0FBSW5CSyxJQUFBQSxVQUFVLEVBQUUsQ0FBQyxJQUFELEVBQU8sV0FBUCxFQUFvQixXQUFwQjtBQUpPLEdBQXJCLEVBTUdDLElBTkgsQ0FNUUMsWUFBWSxJQUFJO0FBQ3BCLFFBQUlBLFlBQUosRUFBa0I7QUFDaEIsYUFBT1YsR0FBRyxDQUFDVyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFDMUJDLFFBQUFBLE9BQU8sRUFBRTtBQURpQixPQUFyQixDQUFQO0FBR0Q7O0FBRUQ7QUFDRCxHQWRILEVBZUdKLElBZkgsQ0FlUUssTUFBTSxJQUFJO0FBQ2RwQixJQUFBQSxZQUFZLENBQUNxQixNQUFiLENBQW9CO0FBQ2xCYixNQUFBQSxTQUFTLEVBQUVBLFNBRE87QUFFbEJDLE1BQUFBLFNBQVMsRUFBRUE7QUFGTyxLQUFwQixFQUlHTSxJQUpILENBSVFDLFlBQVksSUFBSTtBQUNwQlYsTUFBQUEsR0FBRyxDQUFDVyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJGLFlBQXJCO0FBQ0QsS0FOSCxFQU9HTSxLQVBILENBT1NDLEdBQUcsSUFBSTtBQUNaLFlBQU1DLEtBQUssR0FBRyxJQUFJQyxLQUFKLENBQVVGLEdBQVYsQ0FBZDtBQUNBQyxNQUFBQSxLQUFLLENBQUNFLGNBQU4sR0FBdUIsR0FBdkI7QUFDQSxhQUFPbkIsSUFBSSxDQUFDaUIsS0FBRCxDQUFYO0FBQ0QsS0FYSDtBQVlELEdBNUJIO0FBNkJELENBaENEOztBQWtDQXJCLE9BQU8sQ0FBQ3dCLG9CQUFSLEdBQStCLENBQUN0QixHQUFELEVBQU1DLEdBQU4sRUFBV0MsSUFBWCxLQUFvQjtBQUNqRFAsRUFBQUEsWUFBWSxDQUFDNEIsT0FBYixDQUFxQjtBQUFFZCxJQUFBQSxVQUFVLEVBQUUsQ0FBQyxJQUFELEVBQU8sV0FBUCxFQUFvQixXQUFwQjtBQUFkLEdBQXJCLEVBQ0dDLElBREgsQ0FDUWMsYUFBYSxJQUFJO0FBQ3JCdkIsSUFBQUEsR0FBRyxDQUFDVyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFDbkJXLE1BQUFBLGFBQWEsRUFBRUE7QUFESSxLQUFyQjtBQUdELEdBTEgsRUFNR1AsS0FOSCxDQU1TQyxHQUFHLElBQUk7QUFDWixVQUFNQyxLQUFLLEdBQUcsSUFBSUMsS0FBSixDQUFVRixHQUFWLENBQWQ7QUFDQUMsSUFBQUEsS0FBSyxDQUFDRSxjQUFOLEdBQXVCLEdBQXZCO0FBQ0EsV0FBT25CLElBQUksQ0FBQ2lCLEtBQUQsQ0FBWDtBQUNELEdBVkg7QUFXRCxDQVpEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQ29udmVyc2F0aW9uID0gcmVxdWlyZShcIi4uL21vZGVscy9jb252ZXJzYXRpb25cIik7XG5jb25zdCBNZXNzYWdlID0gcmVxdWlyZShcIi4uL21vZGVscy9tZXNzYWdlXCIpO1xuXG5leHBvcnRzLnBvc3RDb252ZXJzYXRpb25zQ3JlYXRlID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHsgdXNlck9uZUlkLCB1c2VyVHdvSWQgfSA9IHJlcS5ib2R5O1xuXG4gIENvbnZlcnNhdGlvbi5maW5kT25lKHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlclR3b0lkOiBOdW1iZXIodXNlclR3b0lkKVxuICAgIH0sXG4gICAgYXR0cmlidXRlczogW1wiaWRcIiwgXCJ1c2VyT25lSWRcIiwgXCJ1c2VyVHdvSWRcIl1cbiAgfSlcbiAgICAudGhlbihjb252ZXJzYXRpb24gPT4ge1xuICAgICAgaWYgKGNvbnZlcnNhdGlvbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6IFwiQ29udmVyc2F0aW9uIGlzIGV4aXN0IGFscmVhZHlcIlxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH0pXG4gICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgIENvbnZlcnNhdGlvbi5jcmVhdGUoe1xuICAgICAgICB1c2VyT25lSWQ6IHVzZXJPbmVJZCxcbiAgICAgICAgdXNlclR3b0lkOiB1c2VyVHdvSWRcbiAgICAgIH0pXG4gICAgICAgIC50aGVuKGNvbnZlcnNhdGlvbiA9PiB7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oY29udmVyc2F0aW9uKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoZXJyKTtcbiAgICAgICAgICBlcnJvci5odHRwU3RhdHVzQ29kZSA9IDUwMDtcbiAgICAgICAgICByZXR1cm4gbmV4dChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxuZXhwb3J0cy5nZXRDb252ZXJzYXRpb25zTGlzdCA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBDb252ZXJzYXRpb24uZmluZEFsbCh7IGF0dHJpYnV0ZXM6IFtcImlkXCIsIFwidXNlck9uZUlkXCIsIFwidXNlclR3b0lkXCJdIH0pXG4gICAgLnRoZW4oY29udmVyc2F0aW9ucyA9PiB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGNvbnZlcnNhdGlvbnM6IGNvbnZlcnNhdGlvbnNcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihlcnIpO1xuICAgICAgZXJyb3IuaHR0cFN0YXR1c0NvZGUgPSA1MDA7XG4gICAgICByZXR1cm4gbmV4dChlcnJvcik7XG4gICAgfSk7XG59O1xuIl19